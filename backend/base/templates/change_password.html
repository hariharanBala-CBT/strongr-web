{% extends 'base_org.html' %}
{% load static %}

{% block content %}

  <link href="{% static 'css/change-password.css' %}" rel="stylesheet" />

  <div class="container-fluid px-4">
    <div class="profile-card">
      <h1 class="my-4">Change Password</h1>

      {% if success_message %}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ success_message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endif %}

      {% for field in form %}
        {% for error in field.errors %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {% if error == "Your old password was entered incorrectly. Please enter it again." %}
            Incorrect old password.
          {% elif error == "The two password fields didnâ€™t match." %}
            New Password doesnt match.
          {% else %}
            {{ error }}
          {% endif %}
        </div>
        {% endfor %}
      {% endfor %}

      <div>

        <form method="post">
          {% csrf_token %}
          {% for field in form %}
            <div class="mb-3 input-group">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
              {{ field }}
              {% if field.field.widget.input_type == 'password' %}
              <span class="btn btn-outline-secondary toggle-password" data-target="{{ field.id_for_label }}">
                <i class="fas fa-eye" id="toggle-password-icon"></i>
              </span>
              {% endif %}
            </div>
          {% endfor %}
          <button class="btn btn-primary" type="submit">Change Password</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.querySelectorAll('.toggle-password').forEach(button => {
      button.addEventListener('click', () => {
        const targetId = button.getAttribute('data-target');
        const input = document.getElementById(targetId);
        const icon = document.getElementById('toggle-password-icon');

        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const $alert = document.querySelector('.alert');
      if ($alert) {
        setTimeout(() => {
          $alert.style.display = 'none';
        }, 2500);
      }
    });
  </script>

{% endblock %}
